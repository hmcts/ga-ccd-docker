{
	"info": {
		"_postman_id": "ba9600fb-5edd-49bf-9b88-49de929ec202",
		"name": "GA-CCD-Docker",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "123095",
		"_collection_link": "https://interstellar-escape-194922.postman.co/workspace/Group-Access~286c0400-9b18-4dce-b0ac-ccb080d518d5/collection/123095-ba9600fb-5edd-49bf-9b88-49de929ec202?action=share&source=collection_link&creator=123095"
	},
	"item": [
		{
			"name": "Utility",
			"item": [
				{
					"name": "GET IDAM User",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [
							{
								"key": "ServiceAuthorization",
								"value": "{{serviceToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{idamBaseUrl}}/testing-support/accounts?email=befta.org.1@gmail.com",
							"host": [
								"{{idamBaseUrl}}"
							],
							"path": [
								"testing-support",
								"accounts"
							],
							"query": [
								{
									"key": "email",
									"value": "befta.org.1@gmail.com"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "Retrieve list of users to refresh",
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [
							{
								"key": "ServiceAuthorization",
								"value": "{{serviceToken}}",
								"type": "text"
							}
						],
						"url": {
							"raw": "{{prdBaseUrl}}/refdata/internal/v1/organisations/users?since=2022-03-15T14%3A30%3A00&page=1&size=1000",
							"host": [
								"{{prdBaseUrl}}"
							],
							"path": [
								"refdata",
								"internal",
								"v1",
								"organisations",
								"users"
							],
							"query": [
								{
									"key": "since",
									"value": "2022-03-15T14%3A30%3A00"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "size",
									"value": "1000"
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Create an organisation",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var jsonData = JSON.parse(responseBody);",
							"pm.collectionVariables.set(\"organisationIdentifier\", jsonData.organisationIdentifier);",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "{{userPrdBearerToken}}",
						"type": "text"
					},
					{
						"key": "ServiceAuthorization",
						"value": "{{serviceToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"name\": \"SolicitorOrg1\",\n    \"status\": \"PENDING\",\n    \"statusMessage\": \"SRA1234561111\",\n    \"sraId\": \"string\",\n    \"sraRegulated\": \"false\",\n    \"companyNumber\": \"W11111W\",\n    \"companyUrl\": \"www.org1.com\",\n    \"superUser\": {\n        \"firstName\": \"Befta\",\n        \"lastName\": \"Org1Admin\",\n        \"email\": \"befta.org.1@gmail.com\"\n    },\n    \"paymentAccount\": [\n        \"PBA1234561\"\n    ],\n    \"contactInformation\": [\n        {\n            \"uprn\": \"UPRN\",\n            \"addressLine1\": \"addressLine1\",\n            \"addressLine2\": \"addressLine2\",\n            \"addressLine3\": \"addressLine3\",\n            \"townCity\": \"Town\",\n            \"county\": \"County\",\n            \"country\": \"Country\",\n            \"postCode\": \"HA1 4ET\",\n            \"dxAddress\": [\n                {\n                    \"dxNumber\": \"dxNumber\",\n                    \"dxExchange\": \"dxExchange\"\n                }\n            ]\n        }\n    ],\n    \"orgType\": \"SOLICITOR_ORG\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{prdBaseUrl}}/refdata/external/v1/organisations",
					"host": [
						"{{prdBaseUrl}}"
					],
					"path": [
						"refdata",
						"external",
						"v1",
						"organisations"
					]
				},
				"description": "This will create an organisation with the super user \"befta.org.1@gmail.com\""
			},
			"response": []
		},
		{
			"name": "Activate an organisation",
			"request": {
				"method": "PUT",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{localPrdAdminBearerToken}}",
						"type": "text"
					},
					{
						"key": "ServiceAuthorization",
						"value": "{{serviceToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"name\": \"SolicitorOrg1\",\n    \"status\": \"ACTIVE\",\n    \"statusMessage\": \"SRA1234561111\",\n    \"sraId\": \"string\",\n    \"sraRegulated\": \"false\",\n    \"companyNumber\": \"W11111W\",\n    \"companyUrl\": \"www.org1.com\",\n    \"superUser\": {\n        \"firstName\": \"Befta\",\n        \"lastName\": \"Org1Admin\",\n        \"email\": \"befta.org.1@gmail.com\"\n    },\n    \"paymentAccount\": [\n        \"PBA1234561\"\n    ],\n    \"contactInformation\": [\n        {\n            \"uprn\": \"UPRN\",\n            \"addressLine1\": \"addressLine1\",\n            \"addressLine2\": \"addressLine2\",\n            \"addressLine3\": \"addressLine3\",\n            \"townCity\": \"Town\",\n            \"county\": \"County\",\n            \"country\": \"Country\",\n            \"postCode\": \"HA1 4ET\",\n            \"dxAddress\": [\n                {\n                    \"dxNumber\": \"dxNumber\",\n                    \"dxExchange\": \"dxExchange\"\n                }\n            ]\n        }\n    ],\n    \"orgType\": \"SOLICITOR_ORG\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{prdBaseUrl}}/refdata/internal/v1/organisations/:organisationId",
					"host": [
						"{{prdBaseUrl}}"
					],
					"path": [
						"refdata",
						"internal",
						"v1",
						"organisations",
						":organisationId"
					],
					"variable": [
						{
							"key": "organisationId",
							"value": "{{organisationIdentifier}}",
							"description": "This is the org id produced from the create organisation operation"
						}
					]
				},
				"description": "This will create an organisation with the super user \"befta.org.1@gmail.com\""
			},
			"response": []
		},
		{
			"name": "Add a user to organisation (internal)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{localPrdAdminBearerToken}}",
						"type": "text"
					},
					{
						"key": "ServiceAuthorization",
						"value": "{{serviceToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"roles\": [\n        \"pui-user-manager\",\n        \"pui-finance-manager\",\n        \"pui-organisation-manager\",\n        \"pui-case-manager\",\n        \"pui-caa\",\n        \"caseworker\",\n        \"caseworker-befta_jurisdiction_1\",\n        \"caseworker-divorce\",\n        \"caseworker-divorce-solicitor\",\n        \"caseworker-divorce-financialremedy\",\n        \"caseworker-divorce-financialremedy-solicitor\",\n        \"caseworker-probate\",\n        \"caseworker-ia\",\n        \"caseworker-probate-solicitor\",\n        \"caseworker-publiclaw\",\n        \"caseworker-ia-legalrep-solicitor\",\n        \"caseworker-publiclaw-solicitor\",\n        \"caseworker-civil\",\n        \"caseworker-civil-solicitor\",\n        \"caseworker-employment\",\n        \"caseworker-employment-legalrep-solicitor\"\n    ],\n    \"accessTypes\": [],\n    \"firstName\": \"Befta\",\n    \"lastName\": \"org1CaseworkerAAA\",\n    \"email\": \"befta.caseworker.1AAA@gmail.com\",\n    \"resendInvite\": false\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{prdBaseUrl}}/refdata/internal/v1/organisations/:organisationId/users/",
					"host": [
						"{{prdBaseUrl}}"
					],
					"path": [
						"refdata",
						"internal",
						"v1",
						"organisations",
						":organisationId",
						"users",
						""
					],
					"variable": [
						{
							"key": "organisationId",
							"value": "BJB81NK"
						}
					]
				}
			},
			"response": []
		},
		{
			"name": "Add a user to organisation (external)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{userPrdBearerToken}}",
						"type": "text"
					},
					{
						"key": "ServiceAuthorization",
						"value": "{{serviceToken}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"roles\": [\n        \"pui-user-manager\",\n        \"pui-finance-manager\",\n        \"pui-organisation-manager\",\n        \"pui-case-manager\",\n        \"pui-caa\",\n        \"caseworker\",\n        \"caseworker-befta_jurisdiction_1\",\n        \"caseworker-divorce\",\n        \"caseworker-divorce-solicitor\",\n        \"caseworker-divorce-financialremedy\",\n        \"caseworker-divorce-financialremedy-solicitor\",\n        \"caseworker-probate\",\n        \"caseworker-ia\",\n        \"caseworker-probate-solicitor\",\n        \"caseworker-publiclaw\",\n        \"caseworker-ia-legalrep-solicitor\",\n        \"caseworker-publiclaw-solicitor\",\n        \"caseworker-civil\",\n        \"caseworker-civil-solicitor\",\n        \"caseworker-employment\",\n        \"caseworker-employment-legalrep-solicitor\"\n    ],\n    \"accessTypes\": [],\n    \"firstName\": \"Befta\",\n    \"lastName\": \"org1CaseworkerAAA\",\n    \"email\": \"befta.caseworker.1AAA@gmail.com\",\n    \"resendInvite\": false\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{prdBaseUrl}}/refdata/external/v1/organisations/users/",
					"host": [
						"{{prdBaseUrl}}"
					],
					"path": [
						"refdata",
						"external",
						"v1",
						"organisations",
						"users",
						""
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// create service token for rd_professional_api",
					"",
					"pm.sendRequest(",
					"    {",
					"        url: 'http://localhost:4502/testing-support/lease',",
					"        method: 'POST',",
					"        header: 'Content-Type: application/json',",
					"        body: {",
					"            mode: 'raw',",
					"            raw: JSON.stringify({\"microservice\": pm.collectionVariables.get('prdServiceName')})",
					"        }",
					"    }, function (err, res) {",
					"        if(!!err) {",
					"            console.log('Error: ' + JSON.stringify(err));",
					"            return;",
					"        }",
					"        console.log('service token', res.text())",
					"        pm.collectionVariables.set(\"serviceToken\", res.text());",
					"        console.log(pm.collectionVariables.get(\"serviceToken\"));",
					"    }",
					");",
					"",
					"// create bearer token for bafta",
					"pm.sendRequest(",
					"    {",
					"        url: 'http://localhost:5000/o/token',",
					"        method: 'POST',",
					"        header: 'Content-Type: application/x-www-form-urlencoded',",
					"        body: {",
					"            mode: 'urlencoded',",
					"            urlencoded: [ ",
					"                {key: \"client_id\", value: pm.variables.get(\"client_id\"), disabled: false},",
					"                {key: \"client_secret\", value: pm.variables.get(\"client_secret\"), disabled: false},",
					"                {key: \"grant_type\", value: \"password\", disabled: false},     ",
					"                {key: \"redirect_uri\", value: \"http://localhost:3451/oauth2redirect\", disabled: false},",
					"                {key: \"username\", value: 'local-prd-admin@gmail.com', disabled: false},                ",
					"                {key: \"password\", value: pm.variables.get(\"tokenPassword\"), disabled: false},                ",
					"                {key: \"scope\", value: 'openid profile roles', disabled: false}",
					"            ]",
					"        }",
					"    }, function (err, res) {",
					"        if(!!err) {",
					"            console.log('Error: ' + JSON.stringify(err));",
					"            return;",
					"        }",
					"        console.log('user token admin', res.json())",
					"        pm.collectionVariables.set(\"localPrdAdminBearerToken\", res.json().access_token);",
					"        console.log(pm.collectionVariables.get(\"localPrdAdminBearerToken\"));",
					"    }",
					");",
					"",
					"",
					"// create bearer token for local prd",
					"pm.sendRequest(",
					"    {",
					"        url: 'http://localhost:5000/o/token',",
					"        method: 'POST',",
					"        header: 'Content-Type: application/x-www-form-urlencoded',",
					"        body: {",
					"            mode: 'urlencoded',",
					"            urlencoded: [ ",
					"                {key: \"client_id\", value: pm.variables.get(\"client_id\"), disabled: false},",
					"                {key: \"client_secret\", value: pm.variables.get(\"client_secret\"), disabled: false},",
					"                {key: \"grant_type\", value: \"password\", disabled: false},     ",
					"                {key: \"redirect_uri\", value: \"http://localhost:3451/oauth2redirect\", disabled: false},",
					"                {key: \"username\", value: 'befta.org.1@gmail.com', disabled: false},                ",
					"                {key: \"password\", value: pm.variables.get(\"tokenPassword\"), disabled: false},                ",
					"                {key: \"scope\", value: 'openid profile roles', disabled: false}",
					"            ]",
					"        }",
					"    }, function (err, res) {",
					"        if(!!err) {",
					"            console.log('Error: ' + JSON.stringify(err));",
					"            return;",
					"        }",
					"        console.log('user token standard', res.json())",
					"        pm.collectionVariables.set(\"userPrdBearerToken\", res.json().access_token);",
					"        console.log(pm.collectionVariables.get(\"userPrdBearerToken\"));",
					"    }",
					");"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "prdBaseUrl",
			"value": "http://localhost:8090",
			"type": "string"
		},
		{
			"key": "localPrdAdminBearerToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "userPrdBearerToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "prdServiceName",
			"value": "rd_professional_api",
			"type": "string"
		},
		{
			"key": "serviceToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "tokenPassword",
			"value": "Pa55word11",
			"type": "string"
		},
		{
			"key": "client_id",
			"value": "ccd_gateway",
			"type": "string"
		},
		{
			"key": "client_secret",
			"value": "ccd_gateway_secret",
			"type": "string"
		},
		{
			"key": "idamBaseUrl",
			"value": "http://localhost:5000",
			"type": "string"
		},
		{
			"key": "organisationIdentifier",
			"value": "",
			"type": "string"
		}
	]
}